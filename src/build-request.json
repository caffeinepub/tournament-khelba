{
  "kind": "build_request",
  "title": "Implement admin access control system using Internet Identity principal IDs",
  "projectName": "Tournament Khelba",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-26",
      "text": "Create backend storage for a list of admin principal IDs in the main actor that persists across canister upgrades through the migration system",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Build the admin system first then I will provide my principal I'd after signing in"
        ]
      },
      "acceptanceCriteria": [
        "Backend maintains a stable array or HashMap of admin principal IDs",
        "Admin list persists through canister upgrades via migration.mo",
        "Initial admin list is empty on first deployment"
      ]
    },
    {
      "id": "REQ-27",
      "text": "Add backend query function 'isAdmin' that checks if the caller's principal ID exists in the admin list and returns a boolean",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Backend configuration that stores a list of admin principal IDs"
        ]
      },
      "acceptanceCriteria": [
        "Query function accepts no parameters and uses caller() to get principal",
        "Returns true only if caller's principal is in the admin list",
        "Returns false for all users when admin list is empty"
      ]
    },
    {
      "id": "REQ-28",
      "text": "Add backend update function 'addAdmin' that allows existing admins to add new principal IDs to the admin list by providing a principal as text parameter",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "You'll be able to add your principal ID and manage the admin list after signing in"
        ]
      },
      "acceptanceCriteria": [
        "Function accepts a principal ID as text parameter",
        "Only callable by existing admins (checks caller is in admin list)",
        "Converts text to Principal type and adds to admin list",
        "Returns success/error result indicating if admin was added",
        "Prevents duplicate entries"
      ]
    },
    {
      "id": "REQ-29",
      "text": "Add backend update function 'removeAdmin' that allows existing admins to remove principal IDs from the admin list by providing a principal as text parameter",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "manage the admin list"
        ]
      },
      "acceptanceCriteria": [
        "Function accepts a principal ID as text parameter",
        "Only callable by existing admins",
        "Removes specified principal from admin list",
        "Returns success/error result",
        "Prevents removing the last admin to avoid complete lockout"
      ]
    },
    {
      "id": "REQ-30",
      "text": "Add backend query function 'getMyPrincipal' that returns the caller's principal ID as text for easy copying",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "I'll add a helper function in the admin panel UI where you can easily copy your principal ID after signing in"
        ]
      },
      "acceptanceCriteria": [
        "Query function accepts no parameters",
        "Returns caller's principal ID converted to text format",
        "Works for any authenticated user"
      ]
    },
    {
      "id": "REQ-31",
      "text": "Update the useQueries.ts useAdminCheck hook to call the backend isAdmin function instead of returning mock data",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Admin panel will check the authenticated user's principal ID against the admin list"
        ]
      },
      "acceptanceCriteria": [
        "Hook calls backend isAdmin query function",
        "Returns loading state while checking",
        "Returns boolean result from backend",
        "Handles authentication errors gracefully"
      ]
    },
    {
      "id": "REQ-32",
      "text": "Update AdminDashboard.tsx to completely block access and redirect non-admin users to the tournament dashboard with an error toast message stating 'Access denied: Admin privileges required'",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "Non-admin users will be completely blocked from accessing admin routes (redirected with an error message)",
          "the existing admin panel becomes completely inaccessible to non-admin users"
        ]
      },
      "acceptanceCriteria": [
        "Component checks admin status using useAdminCheck hook",
        "Redirects non-admin users immediately to /tournaments route",
        "Shows error toast with 'Access denied' message",
        "Does not render any admin UI for non-admin users",
        "Shows loading state while checking admin status"
      ]
    },
    {
      "id": "REQ-33",
      "text": "Update Header.tsx to hide the Admin link in navigation for non-admin users so only admins can see the admin menu option",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "existing admin panel becomes completely inaccessible to non-admin users"
        ]
      },
      "acceptanceCriteria": [
        "Admin link only renders when useAdminCheck returns true",
        "Link is completely hidden (not just disabled) for non-admins",
        "No visual indication that admin panel exists for non-admin users"
      ]
    },
    {
      "id": "REQ-34",
      "text": "Create an AdminSetup component that displays the user's principal ID with a copy-to-clipboard button and a form to add the first admin principal ID, shown only when the admin list is empty",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "I'll add a helper function in the admin panel UI where you can easily copy your principal ID after signing in",
          "You'll be able to add your principal ID and manage the admin list after signing in"
        ]
      },
      "acceptanceCriteria": [
        "Component displays current user's principal ID fetched from backend getMyPrincipal function",
        "Copy button copies principal ID to clipboard with success toast",
        "Form includes text input for principal ID and 'Add First Admin' button",
        "Form calls backend addAdmin function with provided principal",
        "Component only shows when admin list is empty",
        "Shows success message after adding first admin",
        "Includes clear instructions for the user"
      ]
    },
    {
      "id": "REQ-35",
      "text": "Add an Admin Management section to the AdminDashboard that allows existing admins to view the list of current admin principals, add new admins by entering their principal ID, and remove admins with confirmation dialog",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-final"
        ],
        "quotes": [
          "You'll be able to add your principal ID and manage the admin list after signing in",
          "you can easily add more admin principals in the future"
        ]
      },
      "acceptanceCriteria": [
        "Section displays list of all admin principal IDs",
        "Add admin form with text input and submit button",
        "Remove button next to each admin principal with confirmation dialog",
        "Success/error toasts for add/remove operations",
        "Prevents removing the last admin",
        "Refreshes admin list after changes"
      ]
    }
  ],
  "constraints": [
    "Do not modify Internet Identity authentication flow in useInternetIdentity.ts",
    "Do not change the single-actor architecture - all admin logic must be in backend/main.mo",
    "Admin list must persist through canister upgrades via backend/migration.mo",
    "All existing users lose admin access when this change deploys (admin list starts empty)"
  ],
  "nonGoals": [
    "Email-based authentication or email verification",
    "Role-based permissions beyond admin/non-admin",
    "Multi-level admin hierarchy",
    "Admin activity audit logs",
    "Implementing the comprehensive enhancement package (calendar, achievements, analytics) - those come in future phases"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}